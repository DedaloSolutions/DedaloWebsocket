'use strict';const a0_0x146399=a0_0x4ef8;(function(_0x284646,_0x4abe7a){const _0x2121ba=a0_0x4ef8,_0x4930c5=_0x284646();while(!![]){try{const _0x5c1760=parseInt(_0x2121ba(0x22a))/0x1+-parseInt(_0x2121ba(0x223))/0x2*(parseInt(_0x2121ba(0x208))/0x3)+parseInt(_0x2121ba(0x220))/0x4*(-parseInt(_0x2121ba(0x23b))/0x5)+parseInt(_0x2121ba(0x232))/0x6*(-parseInt(_0x2121ba(0x210))/0x7)+parseInt(_0x2121ba(0x20f))/0x8*(-parseInt(_0x2121ba(0x1ee))/0x9)+parseInt(_0x2121ba(0x1f3))/0xa*(-parseInt(_0x2121ba(0x21e))/0xb)+parseInt(_0x2121ba(0x238))/0xc*(parseInt(_0x2121ba(0x218))/0xd);if(_0x5c1760===_0x4abe7a)break;else _0x4930c5['push'](_0x4930c5['shift']());}catch(_0x1b2dd0){_0x4930c5['push'](_0x4930c5['shift']());}}}(a0_0x41a8,0x7ca2b));function a0_0x4ef8(_0x2f4335,_0xfbd15e){const _0x41a876=a0_0x41a8();return a0_0x4ef8=function(_0x4ef8f6,_0x231e28){_0x4ef8f6=_0x4ef8f6-0x1e2;let _0x45a275=_0x41a876[_0x4ef8f6];return _0x45a275;},a0_0x4ef8(_0x2f4335,_0xfbd15e);}var __awaiter=this&&this[a0_0x146399(0x1e3)]||function(_0x3e66f4,_0xe4a48b,_0x2c1bd1,_0x827112){function _0xeb6973(_0x1d8c1a){return _0x1d8c1a instanceof _0x2c1bd1?_0x1d8c1a:new _0x2c1bd1(function(_0x5191a2){_0x5191a2(_0x1d8c1a);});}return new(_0x2c1bd1||(_0x2c1bd1=Promise))(function(_0x1de261,_0x2cb4ab){const _0x5ea137=a0_0x4ef8;function _0xcff917(_0x45a05b){try{_0x290755(_0x827112['next'](_0x45a05b));}catch(_0x28d5ec){_0x2cb4ab(_0x28d5ec);}}function _0x1906ee(_0x4a108f){const _0xb575f2=a0_0x4ef8;try{_0x290755(_0x827112[_0xb575f2(0x215)](_0x4a108f));}catch(_0x28230e){_0x2cb4ab(_0x28230e);}}function _0x290755(_0x41355b){const _0x56550f=a0_0x4ef8;_0x41355b[_0x56550f(0x229)]?_0x1de261(_0x41355b[_0x56550f(0x22d)]):_0xeb6973(_0x41355b['value'])['then'](_0xcff917,_0x1906ee);}_0x290755((_0x827112=_0x827112[_0x5ea137(0x20c)](_0x3e66f4,_0xe4a48b||[]))[_0x5ea137(0x20b)]());});},__importDefault=this&&this['__importDefault']||function(_0x169783){const _0xeb46a=a0_0x146399;return _0x169783&&_0x169783[_0xeb46a(0x23d)]?_0x169783:{'default':_0x169783};};Object[a0_0x146399(0x234)](exports,a0_0x146399(0x23d),{'value':!![]});const crypto_1=__importDefault(require(a0_0x146399(0x22e)));class WebsocketClientServer{constructor(_0x4d32ab){const _0x2c6855=a0_0x146399;this['socket']=_0x4d32ab,this[_0x2c6855(0x22c)]=_0x2c6855(0x217),this['pingInterval']=0x5*0x3e8,this[_0x2c6855(0x216)]=0x2*0x3e8,this['pingRequests']={},this['requestId']=0x1,this['pendingRequests']={},this[_0x2c6855(0x1eb)]={},this[_0x2c6855(0x227)]['on'](_0x2c6855(0x1f8),_0x5a80eb=>this[_0x2c6855(0x203)](_0x5a80eb)),this[_0x2c6855(0x227)]['on'](_0x2c6855(0x23e),_0x4d64a1=>this[_0x2c6855(0x205)](_0x2c6855(0x23e),_0x4d64a1)),this['socket']['on'](_0x2c6855(0x20a),()=>{}),this[_0x2c6855(0x1fb)]();const _0x3bdc27=this[_0x2c6855(0x225)]({'pingInterval':this['pingInterval']});this[_0x2c6855(0x21c)]('binary',_0x3bdc27);}[a0_0x146399(0x201)](){return __awaiter(this,arguments,void 0x0,function*(_0xc8d997=0x3e8,_0x59e315='',_0x3840ef=0x1388){return new Promise((_0x1808e0,_0x1e13e8)=>{const _0x3d4b6c=a0_0x4ef8,_0x1cf52c=Buffer[_0x3d4b6c(0x20d)](_0x59e315,_0x3d4b6c(0x200)),_0x5240e3=Buffer['alloc'](0x2+_0x1cf52c[_0x3d4b6c(0x226)]);_0x5240e3[_0x3d4b6c(0x1ed)](_0xc8d997,0x0),_0x1cf52c[_0x3d4b6c(0x209)](_0x5240e3,0x2);const _0x58ad2f=_0x5240e3['length'],_0x25f1c1=_0x58ad2f<0x7e?_0x58ad2f:_0x58ad2f<0x10000?0x7e:0x7f,_0x35dd17=_0x25f1c1===0x7e?Buffer[_0x3d4b6c(0x20d)]([0x88,0x7e,_0x58ad2f>>0x8&0xff,_0x58ad2f&0xff]):_0x25f1c1===0x7f?Buffer[_0x3d4b6c(0x20d)]([0x88,0x7f,0x0,0x0,0x0,0x0,0x0,0x0,_0x58ad2f>>0x8&0xff,_0x58ad2f&0xff]):Buffer['from']([0x88,_0x58ad2f]),_0x1bc272=Buffer[_0x3d4b6c(0x228)]([_0x35dd17,_0x5240e3]);this['socket'][_0x3d4b6c(0x21f)](_0x1bc272),this[_0x3d4b6c(0x22c)]=_0x3d4b6c(0x1f2);if(_0x3840ef===null)this[_0x3d4b6c(0x22c)]=_0x3d4b6c(0x1fd),this['socket']['end'](),this[_0x3d4b6c(0x205)](_0x3d4b6c(0x20a),{'code':_0xc8d997,'reason':_0x59e315}),_0x1808e0();else{let _0x1ece5c=!![];this[_0x3d4b6c(0x227)][_0x3d4b6c(0x239)](_0x3d4b6c(0x1f8),_0x17a6b9=>{const _0x34e290=_0x3d4b6c;if(!_0x1ece5c)return;_0x17a6b9[0x0]===0x88?(this[_0x34e290(0x22c)]=_0x34e290(0x1fd),this[_0x34e290(0x227)][_0x34e290(0x1e9)](),this[_0x34e290(0x205)](_0x34e290(0x20a),{'code':_0xc8d997,'reason':_0x59e315}),_0x1808e0()):_0x1e13e8(new Error('Failed\x20to\x20receive\x20valid\x20close\x20frame\x20from\x20server.'));}),setTimeout(()=>{const _0x4052ec=_0x3d4b6c;_0x1ece5c=![],_0x1e13e8(new Error('Timeout\x20waiting\x20for\x20close\x20frame\x20acknowledgment.')),this[_0x4052ec(0x227)][_0x4052ec(0x1e9)]();},_0x3840ef);}});});}[a0_0x146399(0x21c)](_0x29a5cd,_0x3f00c6){const _0x51461f=a0_0x146399;let _0x3f0884,_0x2b4f56;switch(_0x29a5cd){case'text':_0x3f0884=Buffer[_0x51461f(0x20d)](_0x3f00c6,_0x51461f(0x200)),_0x2b4f56=0x1;break;case'binary':_0x3f0884=_0x3f00c6,_0x2b4f56=0x2;break;case _0x51461f(0x1f6):_0x3f0884=_0x3f00c6,_0x2b4f56=0x9;break;case _0x51461f(0x1ff):_0x3f0884=_0x3f00c6,_0x2b4f56=0xa;break;}const _0x49efd2=[];if(_0x3f0884[_0x51461f(0x226)]<0x7e)_0x49efd2[_0x51461f(0x23a)](_0x3f0884[_0x51461f(0x226)]);else{if(_0x3f0884[_0x51461f(0x226)]<0x10000)_0x49efd2[_0x51461f(0x23a)](0x7e,_0x3f0884[_0x51461f(0x226)]>>0x8&0xff,_0x3f0884['length']&0xff);else{_0x49efd2[_0x51461f(0x23a)](0x7f);for(let _0xe950d8=0x7;_0xe950d8>=0x0;_0xe950d8--)_0x49efd2['push'](_0x3f0884[_0x51461f(0x226)]>>_0xe950d8*0x8&0xff);}}const _0xa0a0dc=Buffer[_0x51461f(0x228)]([Buffer[_0x51461f(0x20d)]([0x80|_0x2b4f56,..._0x49efd2]),_0x3f0884]);this[_0x51461f(0x227)][_0x51461f(0x21f)](_0xa0a0dc);}['emit'](_0x2bc576,_0x45f828,_0x3c43e4,_0x563c90=0x32*0x3e8){const _0x27be2d=a0_0x146399;if(this['socket']==undefined||this[_0x27be2d(0x22c)]!==_0x27be2d(0x233))throw new Error(_0x27be2d(0x230));if(['handshake',_0x27be2d(0x233),_0x27be2d(0x23e),'close']['includes'](_0x2bc576))throw new Error(_0x27be2d(0x204));const _0x5138be=_0x3c43e4==undefined?0x0:this[_0x27be2d(0x206)],_0x400cd7=Buffer[_0x27be2d(0x20d)](_0x2bc576,_0x27be2d(0x200));if(_0x400cd7[_0x27be2d(0x226)]>0xff)throw new Error(_0x27be2d(0x1fa));if(_0x3c43e4!=undefined){this[_0x27be2d(0x206)]=(this[_0x27be2d(0x206)]+0x1)%0x80||0x1;const _0x4d1689=setTimeout(()=>{const _0x4188c6=_0x27be2d;delete this[_0x4188c6(0x1e7)][_0x5138be],_0x3c43e4(new Error(_0x4188c6(0x1f9)));},_0x563c90);this[_0x27be2d(0x1e7)][_0x5138be]=_0xc6e884=>{if(!(_0xc6e884 instanceof Error))clearTimeout(_0x4d1689);_0x3c43e4(_0xc6e884);};}const _0x4c3215=Buffer[_0x27be2d(0x228)]([Buffer[_0x27be2d(0x20d)]([_0x5138be|0x80,_0x400cd7['length']]),_0x400cd7,this[_0x27be2d(0x225)](_0x45f828)]);this[_0x27be2d(0x21c)](_0x27be2d(0x224),_0x4c3215);}['handle'](_0x403c05){const _0xb739c9=a0_0x146399;var _0x23f866;const _0x460c47=_0x403c05[0x0],_0x8f0717=(_0x460c47&0x80)!==0x0,_0x510e80=_0x460c47&0xf,_0x33e24f=_0x403c05[0x1],_0xa675da=(_0x33e24f&0x80)!==0x0;let _0xc89130=_0x33e24f&0x7f,_0x39ff0f=0x2;if(_0xc89130===0x7e)_0xc89130=_0x403c05['readUInt16BE'](_0x39ff0f),_0x39ff0f+=0x2;else _0xc89130===0x7f&&(_0xc89130=Number(_0x403c05[_0xb739c9(0x235)](_0x39ff0f)),_0x39ff0f+=0x8);const _0x497e65=_0xa675da?_0x403c05['slice'](_0x39ff0f,_0x39ff0f+0x4):Buffer[_0xb739c9(0x22f)](0x0);if(_0xa675da)_0x39ff0f+=0x4;let _0x5dbbf0=_0x403c05[_0xb739c9(0x21a)](_0x39ff0f,_0x39ff0f+_0xc89130);if(_0xa675da){const _0x2c4cba=Buffer[_0xb739c9(0x22f)](_0x5dbbf0['length']);for(let _0x2f8fee=0x0;_0x2f8fee<_0x5dbbf0['length'];_0x2f8fee++)_0x2c4cba[_0x2f8fee]=_0x5dbbf0[_0x2f8fee]^_0x497e65[_0x2f8fee%0x4];_0x5dbbf0=_0x2c4cba;}switch(_0x510e80){case 0x1:this[_0xb739c9(0x205)](_0xb739c9(0x23e),new Error(_0xb739c9(0x1e5)+_0x5dbbf0[_0xb739c9(0x1fe)](_0xb739c9(0x200))));break;case 0x2:{if(this[_0xb739c9(0x22c)]==='handshake'){const _0x56fb18=this[_0xb739c9(0x1f1)](_0x5dbbf0);for(const _0x444a77 of this[_0xb739c9(0x1eb)][_0xb739c9(0x217)]||[]){const _0x1a2f11=_0x444a77[_0xb739c9(0x1ef)](undefined,_0x56fb18);if(_0x1a2f11===![]){this[_0xb739c9(0x201)](0x3e8,'',null);return;}}this[_0xb739c9(0x22c)]=_0xb739c9(0x233),this['send']('binary',Buffer[_0xb739c9(0x22f)](0x0));return;}const _0x3c03a4=_0x5dbbf0[_0xb739c9(0x21d)](0x0),_0x2cd298=_0x3c03a4&0x7f,_0x58d5ca=(_0x3c03a4&0x80)!==0x0;if(_0x58d5ca){const _0x3760d6=_0x5dbbf0[_0xb739c9(0x21d)](0x1),_0x573b6a=_0x5dbbf0['slice'](0x2,0x2+_0x3760d6)[_0xb739c9(0x1fe)](_0xb739c9(0x200));if(['handshake',_0xb739c9(0x233),_0xb739c9(0x23e),_0xb739c9(0x20a)][_0xb739c9(0x1e6)](_0x573b6a)){this[_0xb739c9(0x205)](_0xb739c9(0x23e),new Error('Received\x20a\x20request\x20with\x20eventName\x20'+_0x573b6a+';\x20This\x20is\x20non-standard:\x20someone\x20is\x20trying\x20to\x20hack\x20the\x20protocol?'));return;}const _0x54a790=this['decode'](_0x5dbbf0[_0xb739c9(0x21a)](0x2+_0x3760d6)),_0x315df9=(_0x23f866=this[_0xb739c9(0x1eb)][_0x573b6a])!==null&&_0x23f866!==void 0x0?_0x23f866:[];let _0x4cbdab=![];for(const _0x412581 of _0x315df9){const _0x2a1a1d=_0x412581[_0xb739c9(0x1ef)](undefined,_0x54a790);if(!_0x4cbdab&&_0x2a1a1d!==undefined&&_0x2cd298!==0x0){_0x4cbdab=!![];const _0x553dea=Buffer[_0xb739c9(0x228)]([Buffer[_0xb739c9(0x20d)]([_0x2cd298&0x7f]),this[_0xb739c9(0x225)](_0x2a1a1d)]);this[_0xb739c9(0x21c)](_0xb739c9(0x224),_0x553dea);}}if(!_0x4cbdab&&_0x2cd298!==0x0)this[_0xb739c9(0x205)]('error',new Error(_0xb739c9(0x1f5)+_0x573b6a+_0xb739c9(0x1ec)));return;}const _0x150964=this[_0xb739c9(0x1e7)][_0x2cd298];if(_0x150964==undefined){this[_0xb739c9(0x205)]('error',new Error(_0xb739c9(0x212)+_0x2cd298+'\x20but\x20no\x20pending\x20request\x20was\x20found'));return;}const _0xed31d7=this['decode'](_0x5dbbf0[_0xb739c9(0x21a)](0x1));_0x150964['call'](undefined,_0xed31d7);break;}case 0x9:this[_0xb739c9(0x21c)](_0xb739c9(0x1ff),_0x5dbbf0);break;case 0xa:const _0x109930=_0x5dbbf0['toString'](_0xb739c9(0x200)),_0x5b0d89=this[_0xb739c9(0x22b)][_0x109930];if(_0x5b0d89==undefined){this[_0xb739c9(0x205)](_0xb739c9(0x23e),new Error(_0xb739c9(0x1f4)));return;}_0x5b0d89();break;case 0x8:if(this['status']===_0xb739c9(0x1f2))return;let _0x467d79=0x3e8,_0x50958d='';_0x5dbbf0[_0xb739c9(0x226)]>=0x2&&(_0x467d79=_0x5dbbf0[_0xb739c9(0x211)](0x0),_0x50958d=_0x5dbbf0[_0xb739c9(0x21a)](0x2)[_0xb739c9(0x1fe)](_0xb739c9(0x200)));this[_0xb739c9(0x201)](_0x467d79,_0x50958d,null);break;default:this['raise'](_0xb739c9(0x23e),new Error(_0xb739c9(0x236)+_0x510e80));}}['encode'](_0x2a2fc6){const _0x5b3b01=a0_0x146399;return Buffer['from'](JSON['stringify'](_0x2a2fc6),_0x5b3b01(0x200));}[a0_0x146399(0x1f1)](_0x30b907){const _0x5c26d1=a0_0x146399;return JSON[_0x5c26d1(0x214)](_0x30b907[_0x5c26d1(0x1fe)]('utf-8'));}[a0_0x146399(0x1fb)](){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise((_0xd0ce1a,_0x52eef2)=>{const _0x3a18e9=a0_0x4ef8,_0x183d8d=crypto_1['default'][_0x3a18e9(0x237)](),_0x3e75f7=setTimeout(()=>{const _0x48b5e8=_0x3a18e9;delete this[_0x48b5e8(0x22b)][_0x183d8d],this[_0x48b5e8(0x201)](0x3e8,'',null),_0xd0ce1a(![]);},this[_0x3a18e9(0x216)]);this[_0x3a18e9(0x22b)][_0x183d8d]=()=>{const _0x548ae8=_0x3a18e9;delete this['pingRequests'][_0x183d8d],clearTimeout(_0x3e75f7),_0xd0ce1a(!![]),setTimeout(()=>{const _0x160db9=a0_0x4ef8;if(this[_0x160db9(0x22c)]!==_0x160db9(0x233))return;this['checkHeartbeat']();},this[_0x548ae8(0x231)]);},this['send'](_0x3a18e9(0x1f6),Buffer[_0x3a18e9(0x20d)](_0x183d8d));});});}['on'](_0x34f87d,_0x4bd54f){const _0x38b483=a0_0x146399;if(this['handlers'][_0x34f87d]==undefined)this[_0x38b483(0x1eb)][_0x34f87d]=[];this[_0x38b483(0x1eb)][_0x34f87d][_0x38b483(0x23a)](_0x4bd54f);}[a0_0x146399(0x1fc)](_0x2a07d7,_0x1a678e){const _0x588862=a0_0x146399;if(_0x1a678e==undefined){this[_0x588862(0x1eb)][_0x2a07d7]=[];return;}const _0x392a15=this[_0x588862(0x1eb)][_0x2a07d7],_0x17e65d=(_0x392a15!==null&&_0x392a15!==void 0x0?_0x392a15:[])[_0x588862(0x1e2)](_0x249b0a=>_0x249b0a===_0x1a678e);if(_0x17e65d===-0x1)throw new Error(_0x588862(0x1e4)+_0x2a07d7+_0x588862(0x20e));_0x392a15[_0x588862(0x202)](_0x17e65d,0x1);}[a0_0x146399(0x205)](_0xef4e5e,_0x39220e){const _0x4aa4c8=a0_0x146399;var _0x38974d;const _0x492c87=(_0x38974d=this[_0x4aa4c8(0x1eb)][_0xef4e5e])!==null&&_0x38974d!==void 0x0?_0x38974d:[];for(const _0x5a3def of _0x492c87){_0x5a3def(_0x39220e);}}static[a0_0x146399(0x221)](_0x3a97ff,_0x18ae44){const _0x2deef8=a0_0x146399,_0x539422=_0x3a97ff[_0x2deef8(0x1f7)][_0x2deef8(0x21b)];if(_0x539422==undefined)return _0x18ae44[_0x2deef8(0x1f0)](),null;const _0x1e0d6a=crypto_1[_0x2deef8(0x1ea)]['createHash'](_0x2deef8(0x213));_0x1e0d6a['update'](_0x539422+_0x2deef8(0x1e8));const _0x381667=_0x1e0d6a['digest']('base64'),_0x4d552e=['HTTP/1.1\x20101\x20Switching\x20Protocols',_0x2deef8(0x207),_0x2deef8(0x219),_0x2deef8(0x222)+_0x381667];return _0x18ae44[_0x2deef8(0x21f)](_0x4d552e[_0x2deef8(0x23c)]('\x0d\x0a')+'\x0d\x0a\x0d\x0a'),new WebsocketClientServer(_0x18ae44);}}function a0_0x41a8(){const _0x359251=['toString','pong','utf-8','disconnect','splice','handle','Cannot\x20emit\x20a\x20class\x20internal\x20event\x20as\x20handskake,\x20open,\x20error\x20or\x20close','raise','requestId','Upgrade:\x20websocket','6rKmoNo','copy','close','next','apply','from','\x20event\x20type\x20but\x20it\x20wasn\x27t\x20found','144BbuMxr','7eOYGlb','readUInt16BE','Received\x20a\x20response\x20for\x20the\x20id\x20','sha1','parse','throw','pingTimeout','handshake','595088GROhtE','Connection:\x20Upgrade','slice','sec-websocket-key','send','readUInt8','168520xVkUzB','write','1752912XfUbHF','fromUpgradeRequest','Sec-WebSocket-Accept:\x20','422828rRveah','binary','encode','length','socket','concat','done','527163HGsAyY','pingRequests','status','value','crypto','alloc','The\x20websocket\x20is\x20not\x20connected','pingInterval','1295172gGKiCp','open','defineProperty','readBigUInt64BE','Received\x20message\x20with\x20unsupported\x20opcode:\x20','randomUUID','888vSqPuU','once','push','10xZMrsH','join','__esModule','error','findIndex','__awaiter','Attempted\x20to\x20remove\x20an\x20handler\x20for\x20','Received\x20non-standard\x20text\x20message:\x20','includes','pendingRequests','258EAFA5-E914-47DA-95CA-C5AB0DC85B11','end','default','handlers','\x20but\x20no\x20handler\x20return\x20a\x20result','writeUInt16BE','477207wUoQZk','call','destroy','decode','closing','610fFyXZI','Received\x20a\x20pong,\x20but\x20it\x20doesn\x27t\x20match\x20any\x20ping','Received\x20a\x20request\x20with\x20callback\x20for\x20the\x20event\x20','ping','headers','data','Timeout','Event\x20name\x20too\x20long\x20(max\x20255\x20bytes)','checkHeartbeat','off','closed'];a0_0x41a8=function(){return _0x359251;};return a0_0x41a8();}exports['default']=WebsocketClientServer;