const a4_0x2066d9=a4_0xf2fb;function a4_0xf2fb(_0x57041d,_0x5f388c){const _0x6a0926=a4_0x6a09();return a4_0xf2fb=function(_0xf2fbf5,_0x4abeb6){_0xf2fbf5=_0xf2fbf5-0xbd;let _0x5dacf6=_0x6a0926[_0xf2fbf5];return _0x5dacf6;},a4_0xf2fb(_0x57041d,_0x5f388c);}(function(_0x44c0b5,_0x49364c){const _0x19ecd2=a4_0xf2fb,_0x23d062=_0x44c0b5();while(!![]){try{const _0x590aca=parseInt(_0x19ecd2(0xef))/0x1+-parseInt(_0x19ecd2(0xc6))/0x2+-parseInt(_0x19ecd2(0x101))/0x3+parseInt(_0x19ecd2(0x106))/0x4+-parseInt(_0x19ecd2(0xde))/0x5+-parseInt(_0x19ecd2(0xfd))/0x6*(parseInt(_0x19ecd2(0x103))/0x7)+parseInt(_0x19ecd2(0xdf))/0x8*(parseInt(_0x19ecd2(0xf8))/0x9);if(_0x590aca===_0x49364c)break;else _0x23d062['push'](_0x23d062['shift']());}catch(_0x591e19){_0x23d062['push'](_0x23d062['shift']());}}}(a4_0x6a09,0x8074a));function a4_0x6a09(){const _0x5f28f4=['copy','push','pong','Connection:\x20Upgrade','utf-8','off','pingInterval','3564140jdNcwM','46520KRkAZI','Received\x20a\x20request\x20with\x20eventName\x20','update','open','length','readBigUInt64BE','requestId','toString','createHash','__awaiter','ping','handle','fromUpgradeRequest','destroy','encode','throw','958890NvwIIE','Received\x20message\x20with\x20unsupported\x20opcode:\x20','writeUInt16BE','concat','error','handlers','apply','Received\x20a\x20request\x20with\x20callback\x20for\x20the\x20event\x20','parse','3123aglAGI','raise','Timeout\x20waiting\x20for\x20close\x20frame\x20acknowledgment.','alloc','Upgrade:\x20websocket','30GALXjD','Failed\x20to\x20receive\x20valid\x20close\x20frame\x20from\x20server.','send','Received\x20a\x20pong,\x20but\x20it\x20doesn\x27t\x20match\x20any\x20ping','2900196wEfOTr','findIndex','1206191bLujWd','HTTP/1.1\x20101\x20Switching\x20Protocols','digest','3261964QsvaQQ','stringify','includes','readUInt8','data','value','write','slice','pingRequests','base64','closing','closed','pendingRequests','randomUUID','checkHeartbeat','once','readUInt16BE',';\x20This\x20is\x20non-standard:\x20someone\x20is\x20trying\x20to\x20hack\x20the\x20protocol?','call','status','The\x20websocket\x20is\x20not\x20connected','sha1','1449814cNhhpN','from','258EAFA5-E914-47DA-95CA-C5AB0DC85B11','\x20but\x20no\x20pending\x20request\x20was\x20found','sec-websocket-key','socket','then','close','disconnect','end','Event\x20name\x20too\x20long\x20(max\x20255\x20bytes)','decode','join','next','handshake','binary','splice'];a4_0x6a09=function(){return _0x5f28f4;};return a4_0x6a09();}var __awaiter=this&&this[a4_0x2066d9(0xe8)]||function(_0x188f3f,_0x5250e4,_0x23d288,_0x953902){function _0x3b808d(_0x41d571){return _0x41d571 instanceof _0x23d288?_0x41d571:new _0x23d288(function(_0x5191d3){_0x5191d3(_0x41d571);});}return new(_0x23d288||(_0x23d288=Promise))(function(_0x19c546,_0x8208ef){const _0x55e2a1=a4_0xf2fb;function _0x4c33d0(_0x1140b3){try{_0x3de414(_0x953902['next'](_0x1140b3));}catch(_0x195518){_0x8208ef(_0x195518);}}function _0x30dc28(_0x13f5f1){const _0x490c99=a4_0xf2fb;try{_0x3de414(_0x953902[_0x490c99(0xee)](_0x13f5f1));}catch(_0x2c87dc){_0x8208ef(_0x2c87dc);}}function _0x3de414(_0x4e04b8){const _0xbf2c74=a4_0xf2fb;_0x4e04b8['done']?_0x19c546(_0x4e04b8[_0xbf2c74(0x10b)]):_0x3b808d(_0x4e04b8['value'])[_0xbf2c74(0xcc)](_0x4c33d0,_0x30dc28);}_0x3de414((_0x953902=_0x953902[_0x55e2a1(0xf5)](_0x188f3f,_0x5250e4||[]))[_0x55e2a1(0xd3)]());});};import a4_0x2c53c1 from'crypto';export default class WebsocketClientServer{constructor(_0x74a318){const _0x44c5f0=a4_0x2066d9;this[_0x44c5f0(0xcb)]=_0x74a318,this[_0x44c5f0(0xc3)]='handshake',this['pingInterval']=0x5*0x3e8,this['pingTimeout']=0x2*0x3e8,this[_0x44c5f0(0x10e)]={},this[_0x44c5f0(0xe5)]=0x1,this[_0x44c5f0(0x112)]={},this['locals']={},this[_0x44c5f0(0xf4)]={},this[_0x44c5f0(0xcb)]['on'](_0x44c5f0(0x10a),_0x50c86d=>this['handle'](_0x50c86d)),this[_0x44c5f0(0xcb)]['on'](_0x44c5f0(0xf3),_0x3a74f9=>this['raise']('error',_0x3a74f9)),this[_0x44c5f0(0xcb)]['on'](_0x44c5f0(0xcd),()=>{}),this[_0x44c5f0(0xbe)]();const _0x57d48d=this[_0x44c5f0(0xed)]({'pingInterval':this['pingInterval']});this[_0x44c5f0(0xff)](_0x44c5f0(0xd5),_0x57d48d);}['disconnect'](){return __awaiter(this,arguments,void 0x0,function*(_0x42a6e2=0x3e8,_0x82ec62='',_0x57a0a3=0x1388){return new Promise((_0x523ff3,_0x1cc229)=>{const _0x41dcd0=a4_0xf2fb,_0x5397bf=Buffer[_0x41dcd0(0xc7)](_0x82ec62,_0x41dcd0(0xdb)),_0x4c6d59=Buffer[_0x41dcd0(0xfb)](0x2+_0x5397bf['length']);_0x4c6d59[_0x41dcd0(0xf1)](_0x42a6e2,0x0),_0x5397bf[_0x41dcd0(0xd7)](_0x4c6d59,0x2);const _0x40ca81=_0x4c6d59[_0x41dcd0(0xe3)],_0x49fa7a=_0x40ca81<0x7e?_0x40ca81:_0x40ca81<0x10000?0x7e:0x7f,_0x977ef0=_0x49fa7a===0x7e?Buffer[_0x41dcd0(0xc7)]([0x88,0x7e,_0x40ca81>>0x8&0xff,_0x40ca81&0xff]):_0x49fa7a===0x7f?Buffer[_0x41dcd0(0xc7)]([0x88,0x7f,0x0,0x0,0x0,0x0,0x0,0x0,_0x40ca81>>0x8&0xff,_0x40ca81&0xff]):Buffer[_0x41dcd0(0xc7)]([0x88,_0x40ca81]),_0x275edb=Buffer['concat']([_0x977ef0,_0x4c6d59]);this[_0x41dcd0(0xcb)][_0x41dcd0(0x10c)](_0x275edb),this[_0x41dcd0(0xc3)]=_0x41dcd0(0x110);if(_0x57a0a3===null)this['status']=_0x41dcd0(0x111),this['socket']['end'](),this[_0x41dcd0(0xf9)]('close',{'code':_0x42a6e2,'reason':_0x82ec62}),_0x523ff3();else{let _0x9f9a17=!![];this[_0x41dcd0(0xcb)][_0x41dcd0(0xbf)](_0x41dcd0(0x10a),_0x7fda9=>{const _0x4e0357=_0x41dcd0;if(!_0x9f9a17)return;_0x7fda9[0x0]===0x88?(this[_0x4e0357(0xc3)]=_0x4e0357(0x111),this[_0x4e0357(0xcb)][_0x4e0357(0xcf)](),this[_0x4e0357(0xf9)](_0x4e0357(0xcd),{'code':_0x42a6e2,'reason':_0x82ec62}),_0x523ff3()):_0x1cc229(new Error(_0x4e0357(0xfe)));}),setTimeout(()=>{const _0x592485=_0x41dcd0;_0x9f9a17=![],_0x1cc229(new Error(_0x592485(0xfa))),this[_0x592485(0xcb)][_0x592485(0xcf)]();},_0x57a0a3);}});});}[a4_0x2066d9(0xff)](_0x4e0737,_0x11985e){const _0x233c0a=a4_0x2066d9;let _0x338f68,_0xe7be82;switch(_0x4e0737){case'text':_0x338f68=Buffer[_0x233c0a(0xc7)](_0x11985e,_0x233c0a(0xdb)),_0xe7be82=0x1;break;case'binary':_0x338f68=_0x11985e,_0xe7be82=0x2;break;case'ping':_0x338f68=_0x11985e,_0xe7be82=0x9;break;case'pong':_0x338f68=_0x11985e,_0xe7be82=0xa;break;}const _0xb92a73=[];if(_0x338f68[_0x233c0a(0xe3)]<0x7e)_0xb92a73['push'](_0x338f68[_0x233c0a(0xe3)]);else{if(_0x338f68[_0x233c0a(0xe3)]<0x10000)_0xb92a73[_0x233c0a(0xd8)](0x7e,_0x338f68[_0x233c0a(0xe3)]>>0x8&0xff,_0x338f68[_0x233c0a(0xe3)]&0xff);else{_0xb92a73[_0x233c0a(0xd8)](0x7f);for(let _0x239652=0x7;_0x239652>=0x0;_0x239652--)_0xb92a73[_0x233c0a(0xd8)](_0x338f68['length']>>_0x239652*0x8&0xff);}}const _0x14f66f=Buffer[_0x233c0a(0xf2)]([Buffer[_0x233c0a(0xc7)]([0x80|_0xe7be82,..._0xb92a73]),_0x338f68]);this[_0x233c0a(0xcb)][_0x233c0a(0x10c)](_0x14f66f);}['emit'](_0x1aaa34,_0x20b8b5,_0x592a76,_0x2887fa=0x32*0x3e8){const _0x3f89c6=a4_0x2066d9;if(this[_0x3f89c6(0xcb)]==undefined||this['status']!=='open')throw new Error(_0x3f89c6(0xc4));if(['handshake','open',_0x3f89c6(0xf3),_0x3f89c6(0xcd)][_0x3f89c6(0x108)](_0x1aaa34))throw new Error('Cannot\x20emit\x20a\x20class\x20internal\x20event\x20as\x20handskake,\x20open,\x20error\x20or\x20close');const _0x31c45e=_0x592a76==undefined?0x0:this[_0x3f89c6(0xe5)],_0x45285b=Buffer[_0x3f89c6(0xc7)](_0x1aaa34,_0x3f89c6(0xdb));if(_0x45285b[_0x3f89c6(0xe3)]>0xff)throw new Error(_0x3f89c6(0xd0));if(_0x592a76!=undefined){this[_0x3f89c6(0xe5)]=(this['requestId']+0x1)%0x80||0x1;const _0x2246be=setTimeout(()=>{delete this['pendingRequests'][_0x31c45e],_0x592a76(new Error('Timeout'));},_0x2887fa);this['pendingRequests'][_0x31c45e]=_0x559416=>{if(!(_0x559416 instanceof Error))clearTimeout(_0x2246be);_0x592a76(_0x559416);};}const _0x5d3bef=Buffer[_0x3f89c6(0xf2)]([Buffer[_0x3f89c6(0xc7)]([_0x31c45e|0x80,_0x45285b['length']]),_0x45285b,this['encode'](_0x20b8b5)]);this[_0x3f89c6(0xff)](_0x3f89c6(0xd5),_0x5d3bef);}[a4_0x2066d9(0xea)](_0x302cf9){const _0x46f44e=a4_0x2066d9;var _0x29ba5f;const _0x48dbbe=_0x302cf9[0x0],_0x36dc2e=(_0x48dbbe&0x80)!==0x0,_0x254eeb=_0x48dbbe&0xf,_0x3a49ff=_0x302cf9[0x1],_0x18e4fd=(_0x3a49ff&0x80)!==0x0;let _0x34545e=_0x3a49ff&0x7f,_0x3f2b80=0x2;if(_0x34545e===0x7e)_0x34545e=_0x302cf9[_0x46f44e(0xc0)](_0x3f2b80),_0x3f2b80+=0x2;else _0x34545e===0x7f&&(_0x34545e=Number(_0x302cf9[_0x46f44e(0xe4)](_0x3f2b80)),_0x3f2b80+=0x8);const _0x55a54b=_0x18e4fd?_0x302cf9['slice'](_0x3f2b80,_0x3f2b80+0x4):Buffer[_0x46f44e(0xfb)](0x0);if(_0x18e4fd)_0x3f2b80+=0x4;let _0x4a675c=_0x302cf9[_0x46f44e(0x10d)](_0x3f2b80,_0x3f2b80+_0x34545e);if(_0x18e4fd){const _0x349798=Buffer[_0x46f44e(0xfb)](_0x4a675c[_0x46f44e(0xe3)]);for(let _0x3957fc=0x0;_0x3957fc<_0x4a675c[_0x46f44e(0xe3)];_0x3957fc++)_0x349798[_0x3957fc]=_0x4a675c[_0x3957fc]^_0x55a54b[_0x3957fc%0x4];_0x4a675c=_0x349798;}switch(_0x254eeb){case 0x1:this[_0x46f44e(0xf9)](_0x46f44e(0xf3),new Error('Received\x20non-standard\x20text\x20message:\x20'+_0x4a675c[_0x46f44e(0xe6)](_0x46f44e(0xdb))));break;case 0x2:{if(this['status']===_0x46f44e(0xd4)){const _0x4112ba=this[_0x46f44e(0xd1)](_0x4a675c);for(const _0x312bc7 of this[_0x46f44e(0xf4)][_0x46f44e(0xd4)]||[]){const _0x46bf6b=_0x312bc7['call'](undefined,_0x4112ba);if(_0x46bf6b===![]){this[_0x46f44e(0xce)](0x3e8,'',null);return;}}this[_0x46f44e(0xc3)]=_0x46f44e(0xe2),this[_0x46f44e(0xff)](_0x46f44e(0xd5),Buffer[_0x46f44e(0xfb)](0x0));return;}const _0x490038=_0x4a675c[_0x46f44e(0x109)](0x0),_0x502f0b=_0x490038&0x7f,_0x84c482=(_0x490038&0x80)!==0x0;if(_0x84c482){const _0x3c3826=_0x4a675c['readUInt8'](0x1),_0x5285d7=_0x4a675c['slice'](0x2,0x2+_0x3c3826)[_0x46f44e(0xe6)](_0x46f44e(0xdb));if([_0x46f44e(0xd4),_0x46f44e(0xe2),_0x46f44e(0xf3),_0x46f44e(0xcd)][_0x46f44e(0x108)](_0x5285d7)){this[_0x46f44e(0xf9)](_0x46f44e(0xf3),new Error(_0x46f44e(0xe0)+_0x5285d7+_0x46f44e(0xc1)));return;}const _0x33e3c6=this[_0x46f44e(0xd1)](_0x4a675c[_0x46f44e(0x10d)](0x2+_0x3c3826)),_0x4e1b4f=(_0x29ba5f=this[_0x46f44e(0xf4)][_0x5285d7])!==null&&_0x29ba5f!==void 0x0?_0x29ba5f:[];let _0x2775e6=![];for(const _0x2da4f3 of _0x4e1b4f){const _0x58a8f7=_0x2da4f3['call'](undefined,_0x33e3c6);if(!_0x2775e6&&_0x58a8f7!==undefined&&_0x502f0b!==0x0){_0x2775e6=!![];const _0x56b7ad=Buffer['concat']([Buffer['from']([_0x502f0b&0x7f]),this[_0x46f44e(0xed)](_0x58a8f7)]);this[_0x46f44e(0xff)](_0x46f44e(0xd5),_0x56b7ad);}}if(!_0x2775e6&&_0x502f0b!==0x0)this[_0x46f44e(0xf9)](_0x46f44e(0xf3),new Error(_0x46f44e(0xf6)+_0x5285d7+'\x20but\x20no\x20handler\x20return\x20a\x20result'));return;}const _0x20d125=this[_0x46f44e(0x112)][_0x502f0b];if(_0x20d125==undefined){this[_0x46f44e(0xf9)](_0x46f44e(0xf3),new Error('Received\x20a\x20response\x20for\x20the\x20id\x20'+_0x502f0b+_0x46f44e(0xc9)));return;}const _0x233aff=this[_0x46f44e(0xd1)](_0x4a675c[_0x46f44e(0x10d)](0x1));_0x20d125[_0x46f44e(0xc2)](undefined,_0x233aff);break;}case 0x9:this[_0x46f44e(0xff)](_0x46f44e(0xd9),_0x4a675c);break;case 0xa:const _0x4f8ee3=_0x4a675c[_0x46f44e(0xe6)](_0x46f44e(0xdb)),_0xdaaa7f=this[_0x46f44e(0x10e)][_0x4f8ee3];if(_0xdaaa7f==undefined){this[_0x46f44e(0xf9)](_0x46f44e(0xf3),new Error(_0x46f44e(0x100)));return;}_0xdaaa7f();break;case 0x8:if(this['status']===_0x46f44e(0x110))return;let _0x3e647b=0x3e8,_0x30b2f5='';_0x4a675c[_0x46f44e(0xe3)]>=0x2&&(_0x3e647b=_0x4a675c['readUInt16BE'](0x0),_0x30b2f5=_0x4a675c[_0x46f44e(0x10d)](0x2)[_0x46f44e(0xe6)](_0x46f44e(0xdb)));this['disconnect'](_0x3e647b,_0x30b2f5,null);break;default:this[_0x46f44e(0xf9)](_0x46f44e(0xf3),new Error(_0x46f44e(0xf0)+_0x254eeb));}}[a4_0x2066d9(0xed)](_0xade483){const _0x2bd145=a4_0x2066d9;return Buffer[_0x2bd145(0xc7)](JSON[_0x2bd145(0x107)](_0xade483),'utf-8');}['decode'](_0x576528){const _0x1ba085=a4_0x2066d9;return JSON[_0x1ba085(0xf7)](_0x576528['toString'](_0x1ba085(0xdb)));}[a4_0x2066d9(0xbe)](){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise((_0xf5d675,_0x13a916)=>{const _0x104743=a4_0xf2fb,_0x142023=a4_0x2c53c1[_0x104743(0xbd)](),_0x80b3b9=setTimeout(()=>{const _0x3e6f3f=_0x104743;delete this[_0x3e6f3f(0x10e)][_0x142023],this[_0x3e6f3f(0xce)](0x3e8,'',null),_0xf5d675(![]);},this['pingTimeout']);this['pingRequests'][_0x142023]=()=>{const _0x54ca5e=_0x104743;delete this[_0x54ca5e(0x10e)][_0x142023],clearTimeout(_0x80b3b9),_0xf5d675(!![]),setTimeout(()=>{const _0x5bb81b=_0x54ca5e;if(this['status']!==_0x5bb81b(0xe2))return;this[_0x5bb81b(0xbe)]();},this[_0x54ca5e(0xdd)]);},this['send'](_0x104743(0xe9),Buffer[_0x104743(0xc7)](_0x142023));});});}['on'](_0xb01aa7,_0x3b05bd){const _0x5e1f5c=a4_0x2066d9;if(this['handlers'][_0xb01aa7]==undefined)this[_0x5e1f5c(0xf4)][_0xb01aa7]=[];this[_0x5e1f5c(0xf4)][_0xb01aa7][_0x5e1f5c(0xd8)](_0x3b05bd);}[a4_0x2066d9(0xdc)](_0x337cc2,_0x2ee745){const _0x483478=a4_0x2066d9;if(_0x2ee745==undefined){this[_0x483478(0xf4)][_0x337cc2]=[];return;}const _0x36c8f3=this[_0x483478(0xf4)][_0x337cc2],_0x5097d2=(_0x36c8f3!==null&&_0x36c8f3!==void 0x0?_0x36c8f3:[])[_0x483478(0x102)](_0x1cbddc=>_0x1cbddc===_0x2ee745);if(_0x5097d2===-0x1)throw new Error('Attempted\x20to\x20remove\x20an\x20handler\x20for\x20'+_0x337cc2+'\x20event\x20type\x20but\x20it\x20wasn\x27t\x20found');_0x36c8f3[_0x483478(0xd6)](_0x5097d2,0x1);}[a4_0x2066d9(0xf9)](_0x4b44dd,_0x26143e){const _0x565290=a4_0x2066d9;var _0x3a266c;const _0x115deb=(_0x3a266c=this[_0x565290(0xf4)][_0x4b44dd])!==null&&_0x3a266c!==void 0x0?_0x3a266c:[];for(const _0x5cd307 of _0x115deb){_0x5cd307(_0x26143e);}}static[a4_0x2066d9(0xeb)](_0x403046,_0x104265){const _0x3b6fea=a4_0x2066d9,_0x3eddc8=_0x403046['headers'][_0x3b6fea(0xca)];if(_0x3eddc8==undefined)return _0x104265[_0x3b6fea(0xec)](),null;const _0x55a914=a4_0x2c53c1[_0x3b6fea(0xe7)](_0x3b6fea(0xc5));_0x55a914[_0x3b6fea(0xe1)](_0x3eddc8+_0x3b6fea(0xc8));const _0x42fc4a=_0x55a914[_0x3b6fea(0x105)](_0x3b6fea(0x10f)),_0x5af73d=[_0x3b6fea(0x104),_0x3b6fea(0xfc),_0x3b6fea(0xda),'Sec-WebSocket-Accept:\x20'+_0x42fc4a];return _0x104265[_0x3b6fea(0x10c)](_0x5af73d[_0x3b6fea(0xd2)]('\x0d\x0a')+'\x0d\x0a\x0d\x0a'),new WebsocketClientServer(_0x104265);}}